<!DOCTYPE HTML>
<html>

<body>

    <style>
        .singleprop {
            border-radius: 5px;
            background-color: rgb(240, 240, 240);
            padding: 5px;
            margin: 5px;
        }
    </style>

  <script>
    let propositionList = [
        {
            "text" : "",
            "weight" : 100
        }
    ];

    // if used as getRandomInt(3), will return 1, 2 or 3
    function getRandomInt(max) {
        return Math.floor(Math.random() * max) + 1;
    }

    // get Total weight sum
    function getTotalWeightSum(propositions) {
        totalWeightedSum = 0;
        propositions.forEach(proposition => {
            Math.ceil(proposition.weight);
            totalWeightedSum += proposition.weight;
        });
        return totalWeightedSum;
    }

    // roll randomizer
    function rollRandomized(propositions) {
        let totalWeightedSum = getTotalWeightSum(propositions);
        let randomizedNumber = getRandomInt(totalWeightedSum);
        let currentIndex = 0;
        let resultIndex = -1;

        propositions.forEach(proposition => {
            if (resultIndex == -1) {
                if (randomizedNumber <= proposition.weight) {
                    resultIndex = currentIndex;
                } else {
                    randomizedNumber -= proposition.weight;
                    currentIndex++;
                }
            }
        });
        return resultIndex;
    }

    // check proposition list validity
    function checkValidityList(propositions) {
        isValid = true;

        if (!propositions || propositions.length <= 0)
            return false;

        propositionList.forEach(element => {
            if (!element || !element.text || !element.weight)
                isValid = false;
        });
        return isValid;
    }

    // user starts roll
    function startRoll(propositions) {
        if (checkValidityList(propositions) == false) {
            alert("Please, use valid inputs");
            return;
        }
        let resultIndex = rollRandomized(propositions);
        const divRes = document.querySelector('.result');
        divRes.innerHTML = "<b>Result :</b> " + propositions[resultIndex].text
    }


    // update display of propositions
    function updateDisplay() {
        const div = document.querySelector('.propositionsDisplay');
        div.innerHTML = "";

        propositionList.forEach(function (element, i) {
            let newPropDisplay = div.appendChild(document.createElement('div'));
            newPropDisplay.className = "singleprop";
            newPropDisplay.id = "prop_" + i;
            newPropDisplay.innerHTML = `
                <input placeholder="Name" oninput="updateValue()" value ="` + element.text + `">
                <input placeholder="100" oninput="updateValue()" value="` + element.weight + `">
                <button onclick="removeElement(` + i + `)"> delete element </button>
            `;
        });
    }

    // remove element
    function removeElement(index) {
        propositionList.splice(index, 1);
        updateDisplay();
    }

    // update propositionList
    function updateValue() {
        propositionList = [];
        const div = document.querySelector('.propositionsDisplay');

        for (let i = 0; i < div.children.length; i++) {
            propositionList.push({
                "text" : div.children[i].children[0].value,
                "weight" : parseInt(div.children[i].children[1].value),
            });
        }
    }

    // add element to list
    function addElement() {
        propositionList.push({
            "text" : "",
            "weight" : 100
        });
        updateDisplay();
    }
  </script>
    <h2>This is a beta test for a weighted roulette. No UX-UI has been done so far. This project might be deleted later on.</h2>
    <p>Enter the name of each proposition and its weight (must be a valid integer since no error handling has been done on this project). Then, roll for result.</p><br><br>
    <div class="propositionsDisplay"></div><br><br>

    <button onclick="addElement()">New element</button><br><br>
    <button onclick="startRoll(propositionList)">Roll</button><br><br>

    <div class="result"></div>

    <script>
        updateDisplay();
    </script>


</body>

</html>